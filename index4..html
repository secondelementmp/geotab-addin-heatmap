<!DOCTYPE html>
<html>

<head>
	<title>Toll Activity</title>

	<link rel="stylesheet" href="css/leaflet.css" />


	<script type='text/javascript' src="js/leaflet.js"></script>

	<script type='text/javascript' src='js/palette.js'></script>
	<script type='text/javascript' src='js/leaflet-heat.js'></script>

  <script src="js/main.js"></script>
</head>

<body>
	<div id="map" style="height: 650px">


	</div>


    <br>
    <div>
        <label for="unit">Choose a unit:</label>

        <select name="unit" id="unit">
  
        </select>
    </div>

	<script>

		// map functions


		//init map
		var mymap = L.map('map').setView([39.8, -98.5], 4);
		L.tileLayer(
			//'https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png',
			'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
			//'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWlrZXBpb3Ryb3dza2lzZ3MiLCJhIjoiY2o2NHkyNXQ2MXhvODMybXZjeXdobmRiaiJ9.HLsD87uGE3aZEHaPQpokhw', 
			{
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors', //, Imagery &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
				maxZoom: 18,
				id: 'mapbox/streets-v11',
				tileSize: 512,
				zoomOffset: -1
			}).addTo(mymap);


            var markerLayer = L.layerGroup();

 function addMapMarker(report, data) {


    markerLayer.clearLayers();

    var p = palette('cb-Blues', 9);

    var formatter = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
        //maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
    });


    // var mcg = new L.markerClusterGroup();

    var hm = new Array();

    data['data'][report].map(row => {

        var marker = L.circle([row['OSMLatitude'], row['OSMLongitude']], {
            radius: 250,
            fillColor: 'black',
            opacity: 0,
            fillOpacity: 0.5

        }).bindPopup(row['LocationName'] + "<br>" + formatter.format(row['Amount']).toString());

        /*
                        var marker = L.circleMarker([row['OSMLatitude'], row['OSMLongitude']], {
                            fillColor: '#' + p[Math.trunc(Math.log10(row['Amount'])) + 1],
                            color: '#' + p[8],
                            radius: 10,
                            fillOpacity: 0.8,
                            opacity: 1
        
                        }).bindPopup(formatter.format(row['Amount']).toString());
        */
        //mcg.addLayer(marker);

        markerLayer.addLayer(marker);

        hm.push([row['OSMLatitude'], row['OSMLongitude'], row['Amount']]);
    })

    //mcg.addTo(markerLayer);
    //   markerLayer.addTo(mymap);


    var heat = L.heatLayer(hm, { radius: 25, max: 10000, minOpacity: 0.5}).addTo(mymap);
    markerLayer.addLayer(heat);

    markerLayer.addTo(mymap);



}



data={
  "data": {
    "factUsage": [
      {
        "Amount": 38862.17,
        "OSMLatitude": 40.641047,
        "OSMLongitude": -74.209967,
        "LocationName": "I-287/Eliz/Goethals/Verrazano"
      },
      {
        "Amount": 80,
        "OSMLatitude": 39.507981,
        "OSMLongitude": -74.678881,
        "LocationName": "Route 50"
      },
      {
        "Amount": 4941.81,
        "OSMLatitude": 40.025953,
        "OSMLongitude": -74.819114,
        "LocationName": "Burlington/Mt. Holly"
      },
      {
        "Amount": 175.19,
        "OSMLatitude": 39.204851,
        "OSMLongitude": -75.547757,
        "LocationName": "Denney's Road Ramp"
      }
      ]
  }
}      


addMapMarker("factUsage", data)


</script>

</body>

</html>